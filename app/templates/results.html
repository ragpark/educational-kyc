{% extends "base.html" %}

{% block title %}Verification Results - Educational Provider KYC{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="mb-8">
        <h2 class="text-3xl font-bold text-gray-900 mb-2">KYC Verification Results</h2>
        <p class="text-gray-600">Verification completed for {{ provider.organisation_name }}</p>
    </div>
    
    <!-- Status Banner -->
    <div class="mb-8 p-6 rounded-lg {% if provider.status == 'approved' %}bg-green-50 border border-green-200{% else %}bg-yellow-50 border border-yellow-200{% endif %}">
        <div class="flex items-center">
            {% if provider.status == 'approved' %}
                <div class="flex-shrink-0">
                    <span class="text-4xl">✅</span>
                </div>
                <div class="ml-4">
                    <h3 class="text-lg font-medium text-green-900">Provider Approved</h3>
                    <p class="text-green-800">All KYC checks have passed successfully. This provider meets UK educational compliance standards.</p>
                </div>
            {% else %}
                <div class="flex-shrink-0">
                    <span class="text-4xl">⚠️</span>
                </div>
                <div class="ml-4">
                    <h3 class="text-lg font-medium text-yellow-900">Manual Review Required</h3>
                    <p class="text-yellow-800">Some checks require additional review before final approval.</p>
                </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Provider Summary -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Provider Summary</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <dl class="space-y-3">
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Organisation Name</dt>
                        <dd class="text-sm text-gray-900">{{ provider.organisation_name }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Provider Type</dt>
                        <dd class="text-sm text-gray-900">{{ provider.provider_type }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Companies House Number</dt>
                        <dd class="text-sm text-gray-900">{{ provider.company_number or 'Not provided' }}</dd>
                    </div>
                </dl>
            </div>
            <div>
                <dl class="space-y-3">
                    <div>
                        <dt class="text-sm font-medium text-gray-500">UKPRN</dt>
                        <dd class="text-sm text-gray-900">{{ provider.ukprn or 'Not provided' }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Risk Level</dt>
                        <dd>
                            <span class="px-2 py-1 text-xs font-semibold rounded-full 
                                {% if provider.risk_level == 'low' %}bg-green-100 text-green-800
                                {% elif provider.risk_level == 'medium' %}bg-yellow-100 text-yellow-800
                                {% else %}bg-red-100 text-red-800{% endif %}">
                                {{ provider.risk_level.title() }} Risk
                            </span>
                        </dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Verification Date</dt>
                        <dd class="text-sm text-gray-900">{{ provider.created_at }}</dd>
                    </div>
                </dl>
            </div>
        </div>
    </div>
    
    <!-- Verification Checks -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
        <h3 class="text-lg font-semibold text-gray-900 mb-6">Verification Checks</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            {% for check_name, check_result in provider.kyc_results.items() %}
                {% if check_name != 'overall_risk' %}
                <div class="border border-gray-200 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="text-sm font-medium text-gray-900">
                            {{ check_name.replace('_', ' ').title() }}
                        </h4>
                        {% if check_result.status == 'passed' %}
                            <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                                ✓ Passed
                            </span>
                        {% elif check_result.status == 'flagged' %}
                            <span class="px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">
                                ⚠ Flagged
                            </span>
                        {% elif check_result.status == 'failed' %}
                            <span class="px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">
                                ✗ Failed
                            </span>
                        {% else %}
                            <span class="px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">
                                {{ check_result.status.title() }}
                            </span>
                        {% endif %}
                    </div>
                    
                    <div class="text-xs text-gray-600">
                        Risk Score: {{ "%.1f"|format(check_result.risk_score * 100) }}%
                    </div>
                    
                    {% if check_name == 'companies_house' %}
                        <p class="text-xs text-gray-500 mt-2">Verified against Companies House register</p>
                    {% elif check_name == 'ukprn_validation' %}
                        <p class="text-xs text-gray-500 mt-2">Validated with UK Register of Learning Providers</p>
                    {% elif check_name == 'ofqual_check' %}
                        <p class="text-xs text-gray-500 mt-2">Checked against Ofqual regulated qualifications</p>
                    {% endif %}
                </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>
    
    <!-- Risk Assessment -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Risk Assessment</h3>
        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
            <div>
                <p class="text-sm font-medium text-gray-900">Overall Risk Score</p>
                <p class="text-xs text-gray-600">Based on all verification checks</p>
            </div>
            <div class="text-right">
                <p class="text-2xl font-bold 
                    {% if provider.kyc_results.overall_risk < 0.3 %}text-green-600
                    {% elif provider.kyc_results.overall_risk < 0.6 %}text-yellow-600
                    {% else %}text-red-600{% endif %}">
                    {{ "%.1f"|format(provider.kyc_results.overall_risk * 100) }}%
                </p>
                <p class="text-xs text-gray-500">Risk Level</p>
            </div>
        </div>
    </div>
    
    <!-- Actions -->
    <div class="flex justify-between items-center">
        <a href="/" 
           class="text-gray-600 hover:text-gray-800 transition-colors">
            ← Back to Dashboard
        </a>
        <div class="space-x-4">
            <a href="/onboard" 
               class="bg-gray-600 text-white px-6 py-2 rounded-md hover:bg-gray-700 transition-colors">
                Add Another Provider
            </a>
            <button onclick="window.print()" 
                    class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition-colors">
                Print Results
            </button>
        </div>
    </div>
</div>
{% endblock %}