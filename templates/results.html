{% extends "base.html" %}
{% block title %}Verification Results - {{ provider.organisation_name }}{% endblock %}
{% block content %}
<div class="max-w-6xl mx-auto">
    <!-- Header -->
    <div class="mb-8">
        <h2 class="text-3xl font-bold text-gray-900 mb-2">KYC Verification Results</h2>
        <p class="text-gray-600">Comprehensive verification completed for {{ provider.organisation_name }}</p>
        <div class="mt-2 text-sm text-gray-500">
            Verification ID: {{ provider.verification_id }} | 
            Completed: {{ provider.processing_completed or provider.created_at }}
        </div>
    </div>
    
    <!-- Overall Status -->
    {% if provider.status == 'approved' %}
    <div class="bg-green-50 border border-green-200 p-6 rounded-lg mb-8">
        <div class="flex items-center">
            <span class="text-4xl">‚úÖ</span>
            <div class="ml-4">
                <h3 class="text-lg font-medium text-green-900">Provider Approved</h3>
                <p class="text-green-800">KYC verification completed successfully with {{ provider.risk_level }} risk profile.</p>
                <p class="text-sm text-green-700 mt-1">Overall Risk Score: {{ "%.2f"|format(provider.overall_risk_score or 0) }}</p>
            </div>
        </div>
    </div>
    {% elif provider.status == 'review_required' %}
    <div class="bg-yellow-50 border border-yellow-200 p-6 rounded-lg mb-8">
        <div class="flex items-center">
            <span class="text-4xl">‚ö†Ô∏è</span>
            <div class="ml-4">
                <h3 class="text-lg font-medium text-yellow-900">Review Required</h3>
                <p class="text-yellow-800">Additional review needed before approval. Risk level: {{ provider.risk_level }}.</p>
                <p class="text-sm text-yellow-700 mt-1">Overall Risk Score: {{ "%.2f"|format(provider.overall_risk_score or 0) }}</p>
            </div>
        </div>
    </div>
    {% elif provider.status == 'rejected' %}
    <div class="bg-red-50 border border-red-200 p-6 rounded-lg mb-8">
        <div class="flex items-center">
            <span class="text-4xl">‚ùå</span>
            <div class="ml-4">
                <h3 class="text-lg font-medium text-red-900">Provider Rejected</h3>
                <p class="text-red-800">KYC verification failed. Risk level: {{ provider.risk_level }}.</p>
                <p class="text-sm text-red-700 mt-1">Overall Risk Score: {{ "%.2f"|format(provider.overall_risk_score or 0) }}</p>
            </div>
        </div>
    </div>
    {% else %}
    <div class="bg-blue-50 border border-blue-200 p-6 rounded-lg mb-8">
        <div class="flex items-center">
            <span class="text-4xl">üîÑ</span>
            <div class="ml-4">
                <h3 class="text-lg font-medium text-blue-900">{{ provider.status|title }}</h3>
                <p class="text-blue-800">Verification status: {{ provider.status }}.</p>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Provider Summary -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Provider Summary</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="space-y-3">
                <div>
                    <label class="text-sm font-medium text-gray-500">Organisation Name</label>
                    <p class="text-gray-900">{{ provider.organisation_name }}</p>
                </div>
                <div>
                    <label class="text-sm font-medium text-gray-500">Provider Type</label>
                    <p class="text-gray-900">{{ provider.provider_type or 'Not specified' }}</p>
                </div>
                <div>
                    <label class="text-sm font-medium text-gray-500">Trading Name</label>
                    <p class="text-gray-900">{{ provider.trading_name or 'Not provided' }}</p>
                </div>
            </div>
            <div class="space-y-3">
                <div>
                    <label class="text-sm font-medium text-gray-500">Company Number</label>
                    <p class="text-gray-900 font-mono">{{ provider.company_number or 'Not provided' }}</p>
                </div>
                <div>
                    <label class="text-sm font-medium text-gray-500">URN</label>
                    <p class="text-gray-900 font-mono">{{ provider.urn or 'Not provided' }}</p>
                </div>
                <div>
                    <label class="text-sm font-medium text-gray-500">UKPRN</label>
                    <p class="text-gray-900 font-mono">{{ provider.ukprn or 'Not provided' }}</p>
                </div>
                <div>
                    <label class="text-sm font-medium text-gray-500">JCQ Centre Number</label>
                    <p class="text-gray-900 font-mono">{{ provider.jcq_centre_number or 'Not provided' }}</p>
                </div>
            </div>
            <div class="space-y-3">
                <div>
                    <label class="text-sm font-medium text-gray-500">Risk Level</label>
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                        {% if provider.risk_level == 'low' %}bg-green-100 text-green-800{% elif provider.risk_level == 'medium' %}bg-yellow-100 text-yellow-800{% elif provider.risk_level == 'high' %}bg-red-100 text-red-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                        {{ provider.risk_level|title }}
                    </span>
                </div>
                <div>
                    <label class="text-sm font-medium text-gray-500">Verification Date</label>
                    <p class="text-gray-900">{{ provider.created_at }}</p>
                </div>
                <div>
                    <label class="text-sm font-medium text-gray-500">Contact Email</label>
                    <p class="text-gray-900">{{ provider.contact_email or 'Not provided' }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Verification Checks Results -->
    {% if provider.kyc_results %}
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
        <h3 class="text-lg font-semibold text-gray-900 mb-6">Verification Check Results</h3>
        
        <!-- Risk Score Summary -->
        {% if provider.overall_risk_score is defined %}
        <div class="mb-6 p-4 bg-gray-50 rounded-lg">
            <div class="flex items-center justify-between mb-2">
                <span class="text-sm font-medium text-gray-600">Overall Risk Score</span>
                <span class="text-lg font-bold text-gray-900">{{ "%.1f%%"|format((provider.overall_risk_score or 0) * 100) }}</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2.5">
                <div class="bg-gradient-to-r 
                    {% if (provider.overall_risk_score or 0) < 0.3 %}from-green-400 to-green-600{% elif (provider.overall_risk_score or 0) < 0.6 %}from-yellow-400 to-yellow-600{% else %}from-red-400 to-red-600{% endif %} 
                    h-2.5 rounded-full transition-all duration-300" 
                    style="width: {{ ((provider.overall_risk_score or 0) * 100)|round(1) }}%"></div>
            </div>
        </div>
        {% endif %}

        <!-- Individual Check Results -->
        <div class="space-y-4">
            
            <!-- Company Registration (Companies House) -->
            {% if provider.kyc_results.company_registration %}
            {% set check = provider.kyc_results.company_registration %}
            <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <div class="flex items-center mb-2">
                            <h4 class="text-base font-medium text-gray-900">Companies House Verification</h4>
                            <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                                {% if check.status == 'passed' %}bg-green-100 text-green-800{% elif check.status == 'flagged' %}bg-yellow-100 text-yellow-800{% elif check.status == 'failed' %}bg-red-100 text-red-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                                {{ check.status|title }}
                            </span>
                        </div>
                        <p class="text-sm text-gray-600 mb-3">{{ check.data_source }}</p>
                        
                        {% if check.details %}
                        <div class="space-y-3">
                            <!-- Basic Company Information -->
                            <div class="bg-gray-50 rounded-lg p-3">
                                <h5 class="text-sm font-semibold text-gray-900 mb-2">Company Details</h5>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                                    {% if check.details.company_name %}
                                    <div>
                                        <span class="font-medium text-gray-700">Company Name:</span>
                                        <p class="text-gray-900">{{ check.details.company_name }}</p>
                                    </div>
                                    {% endif %}
                                    
                                    {% if check.details.company_status %}
                                    <div>
                                        <span class="font-medium text-gray-700">Status:</span>
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium
                                            {% if check.details.company_status == 'active' %}bg-green-100 text-green-800{% else %}bg-red-100 text-red-800{% endif %}">
                                            {{ check.details.company_status|title }}
                                        </span>
                                    </div>
                                    {% endif %}
                                    
                                    {% if check.details.incorporation_date %}
                                    <div>
                                        <span class="font-medium text-gray-700">Incorporated:</span>
                                        <p class="text-gray-900">{{ check.details.incorporation_date }}</p>
                                    </div>
                                    {% endif %}
                                    
                                    {% if check.details.company_type %}
                                    <div>
                                        <span class="font-medium text-gray-700">Company Type:</span>
                                        <p class="text-gray-900">{{ check.details.company_type.replace('-', ' ')|title }}</p>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <!-- Registered Office Address -->
                            {% if check.details.registered_office %}
                            <div class="bg-blue-50 rounded-lg p-3">
                                <h5 class="text-sm font-semibold text-gray-900 mb-2">Registered Office</h5>
                                <div class="text-sm text-gray-700">
                                    {% if check.details.registered_office.address_line_1 %}
                                    <p>{{ check.details.registered_office.address_line_1 }}</p>
                                    {% endif %}
                                    {% if check.details.registered_office.address_line_2 %}
                                    <p>{{ check.details.registered_office.address_line_2 }}</p>
                                    {% endif %}
                                    {% if check.details.registered_office.locality %}
                                    <p>{{ check.details.registered_office.locality }}</p>
                                    {% endif %}
                                    {% if check.details.registered_office.region %}
                                    <p>{{ check.details.registered_office.region }}</p>
                                    {% endif %}
                                    {% if check.details.registered_office.postal_code %}
                                    <p class="font-mono">{{ check.details.registered_office.postal_code }}</p>
                                    {% endif %}
                                    {% if check.details.registered_office.country %}
                                    <p class="font-medium">{{ check.details.registered_office.country }}</p>
                                    {% endif %}
                                </div>
                            </div>
                            {% endif %}
                            
                            <!-- SIC Codes -->
                            {% if check.details.sic_codes %}
                            <div class="bg-purple-50 rounded-lg p-3">
                                <h5 class="text-sm font-semibold text-gray-900 mb-2">Business Activities (SIC Codes)</h5>
                                <div class="space-y-1">
                                    {% for sic in check.details.sic_codes %}
                                    <span class="inline-block bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded-full mr-1">
                                        {{ sic }}
                                    </span>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}
                            
                            <!-- Officers Information -->
                            {% if check.details.officers_count is defined and check.details.officers_count != 'unknown' %}
                            <div class="bg-yellow-50 rounded-lg p-3">
                                <h5 class="text-sm font-semibold text-gray-900 mb-2">Company Officers</h5>
                                <div class="text-sm">
                                    <p class="text-gray-700">
                                        <span class="font-medium">Total Officers:</span> {{ check.details.officers_count }}
                                    </p>
                                    {% if check.details.recent_filings is defined and check.details.recent_filings != 'unknown' %}
                                    <p class="text-gray-700 mt-1">
                                        <span class="font-medium">Recent Filings:</span> {{ check.details.recent_filings }}
                                    </p>
                                    {% endif %}
                                </div>
                            </div>
                            {% endif %}
                            
                            <!-- Financial Information -->
                            {% if check.details.outstanding_charges is defined and check.details.outstanding_charges != 'unknown' %}
                            <div class="{% if check.details.outstanding_charges > 0 %}bg-red-50{% else %}bg-green-50{% endif %} rounded-lg p-3">
                                <h5 class="text-sm font-semibold text-gray-900 mb-2">Financial Status</h5>
                                <div class="text-sm">
                                    <p class="{% if check.details.outstanding_charges > 0 %}text-red-700{% else %}text-green-700{% endif %}">
                                        <span class="font-medium">Outstanding Charges:</span> 
                                        {% if check.details.outstanding_charges == 0 %}
                                            None ‚úì
                                        {% else %}
                                            {{ check.details.outstanding_charges }}
                                        {% endif %}
                                    </p>
                                </div>
                            </div>
                            {% endif %}
                            
                            <!-- PSC Information -->
                            {% if check.details.has_psc_data is defined %}
                            <div class="bg-indigo-50 rounded-lg p-3">
                                <h5 class="text-sm font-semibold text-gray-900 mb-2">Persons with Significant Control</h5>
                                <div class="text-sm">
                                    <p class="text-indigo-700">
                                        <span class="font-medium">PSC Data Available:</span> 
                                        {% if check.details.has_psc_data %}
                                            Yes ‚úì
                                        {% else %}
                                            No
                                        {% endif %}
                                    </p>
                                </div>
                            </div>
                            {% endif %}
                            
                            <!-- Risk Factors -->
                            {% if check.details.risk_factors %}
                            <div class="bg-orange-50 rounded-lg p-3">
                                <h5 class="text-sm font-semibold text-gray-900 mb-2">Risk Factors Identified</h5>
                                <ul class="text-sm text-orange-700 space-y-1">
                                    {% for factor in check.details.risk_factors %}
                                    <li class="flex items-start">
                                        <svg class="h-4 w-4 text-orange-500 mt-0.5 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                        </svg>
                                        {{ factor.replace('_', ' ')|title }}
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>
                            {% endif %}
                            
                            <!-- Name Matching -->
                            {% if check.details.name_match is defined %}
                            <div class="{% if check.details.name_match %}bg-green-50{% else %}bg-yellow-50{% endif %} rounded-lg p-3">
                                <h5 class="text-sm font-semibold text-gray-900 mb-2">Name Verification</h5>
                                <p class="text-sm {% if check.details.name_match %}text-green-700{% else %}text-yellow-700{% endif %}">
                                    <span class="font-medium">Name Match:</span>
                                    {% if check.details.name_match %}
                                        ‚úì Company name matches application
                                    {% else %}
                                        ‚ö† Company name differs from application
                                    {% endif %}
                                </p>
                            </div>
                            {% endif %}
                            
                            <!-- Confidence Score -->
                            {% if check.confidence is defined %}
                            <div class="bg-gray-100 rounded-lg p-3">
                                <h5 class="text-sm font-semibold text-gray-900 mb-2">Data Quality</h5>
                                <div class="flex items-center">
                                    <span class="text-sm font-medium text-gray-700 mr-2">Confidence:</span>
                                    <div class="flex-1 bg-gray-200 rounded-full h-2 mr-2">
                                        <div class="bg-blue-600 h-2 rounded-full" style="width: {{ (check.confidence * 100)|round(0) }}%"></div>
                                    </div>
                                    <span class="text-sm font-medium text-gray-900">{{ (check.confidence * 100)|round(0) }}%</span>
                                </div>
                            </div>
                            {% endif %}
                            
                            <!-- API Error Details -->
                            {% if check.details.error %}
                            <div class="bg-red-50 border border-red-200 rounded-lg p-3">
                                <h5 class="text-sm font-semibold text-red-900 mb-2">Verification Issue</h5>
                                <p class="text-sm text-red-700">{{ check.details.error }}</p>
                                {% if check.details.http_status %}
                                <p class="text-xs text-red-600 mt-1">HTTP Status: {{ check.details.http_status }}</p>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                        {% endif %}
                        
                        {% if check.recommendations %}
                        <div class="mt-3 pt-3 border-t border-gray-200">
                            <p class="text-xs font-medium text-gray-500 mb-2">Recommendations:</p>
                            <ul class="text-xs text-gray-600 space-y-1">
                                {% for rec in check.recommendations %}
                                <li class="flex items-start">
                                    <svg class="h-3 w-3 text-blue-500 mt-0.5 mr-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                                    </svg>
                                    {{ rec }}
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                    <div class="ml-4 text-right">
                        <div class="text-lg font-bold text-gray-900">{{ "%.1f%%"|format((check.risk_score or 0) * 100) }}</div>
                        <div class="text-xs text-gray-500">Risk Score</div>
                        {% if check.confidence is defined %}
                        <div class="text-xs text-gray-400 mt-1">{{ (check.confidence * 100)|round(0) }}% confidence</div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- UKPRN Validation -->
            {% if provider.kyc_results.ukprn_validation %}
            {% set check = provider.kyc_results.ukprn_validation %}
            <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <div class="flex items-center mb-2">
                            <h4 class="text-base font-medium text-gray-900">UKPRN Validation</h4>
                            <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                                {% if check.status == 'passed' %}bg-green-100 text-green-800{% elif check.status == 'flagged' %}bg-yellow-100 text-yellow-800{% elif check.status == 'failed' %}bg-red-100 text-red-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                                {{ check.status|title }}
                            </span>
                        </div>
                        <p class="text-sm text-gray-600 mb-3">{{ check.data_source }}</p>
                        
                        {% if check.details %}
                        <div class="space-y-3">
                            <!-- Main Provider Information -->
                            <div class="bg-blue-50 rounded-lg p-3">
                                <h5 class="text-sm font-semibold text-gray-900 mb-2">UKRLP Provider Details</h5>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                                    {% if check.details.provider_name %}
                                    <div>
                                        <span class="font-medium text-gray-700">Provider Name:</span>
                                        <p class="text-gray-900">{{ check.details.provider_name }}</p>
                                    </div>
                                    {% endif %}
                                    
                                    {% if check.details.verification_status %}
                                    <div>
                                        <span class="font-medium text-gray-700">Verification Status:</span>
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ml-2
                                            {% if check.details.verification_status == 'Verified' %}bg-green-100 text-green-800{% else %}bg-red-100 text-red-800{% endif %}">
                                            {{ check.details.verification_status }}
                                        </span>
                                    </div>
                                    {% endif %}
                                    
                                    {% if check.details.provider_status %}
                                    <div>
                                        <span class="font-medium text-gray-700">Provider Status:</span>
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ml-2
                                            {% if check.details.provider_status == 'Active' %}bg-green-100 text-green-800
                                            {% elif check.details.provider_status == 'Inactive' %}bg-yellow-100 text-yellow-800
                                            {% elif check.details.provider_status == 'Deactivated' %}bg-red-100 text-red-800
                                            {% else %}bg-gray-100 text-gray-800{% endif %}">
                                            {{ check.details.provider_status }}
                                        </span>
                                    </div>
                                    {% endif %}
                                    
                                    {% if check.details.ukprn %}
                                    <div>
                                        <span class="font-medium text-gray-700">UKPRN:</span>
                                        <p class="text-gray-900 font-mono">{{ check.details.ukprn }}</p>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <!-- Additional Provider Information -->
                            {% if check.details.provider_type or check.details.legal_name or check.details.trading_name %}
                            <div class="bg-gray-50 rounded-lg p-3">
                                <h5 class="text-sm font-semibold text-gray-900 mb-2">Additional Information</h5>
                                <div class="text-sm space-y-1">
                                    {% if check.details.legal_name %}
                                    <p><span class="font-medium text-gray-700">Legal Name:</span> {{ check.details.legal_name }}</p>
                                    {% endif %}
                                    {% if check.details.trading_name %}
                                    <p><span class="font-medium text-gray-700">Trading Name:</span> {{ check.details.trading_name }}</p>
                                    {% endif %}
                                    {% if check.details.provider_type %}
                                    <p><span class="font-medium text-gray-700">Provider Type:</span> {{ check.details.provider_type }}</p>
                                    {% endif %}
                                    {% if check.details.registration_date %}
                                    <p><span class="font-medium text-gray-700">Registration Date:</span> {{ check.details.registration_date }}</p>
                                    {% endif %}
                                </div>
                            </div>
                            {% endif %}
                            
                            <!-- Contact Information -->
                            {% if check.details.address or check.details.contact_number or check.details.email or check.details.website %}
                            <div class="bg-purple-50 rounded-lg p-3">
                                <h5 class="text-sm font-semibold text-gray-900 mb-2">Contact Details</h5>
                                <div class="text-sm space-y-1">
                                    {% if check.details.address %}
                                    <p><span class="font-medium text-gray-700">Address:</span> {{ check.details.address }}</p>
                                    {% endif %}
                                    {% if check.details.contact_number %}
                                    <p><span class="font-medium text-gray-700">Phone:</span> {{ check.details.contact_number }}</p>
                                    {% endif %}
                                    {% if check.details.email %}
                                    <p><span class="font-medium text-gray-700">Email:</span> 
                                       <a href="mailto:{{ check.details.email }}" class="text-blue-600 hover:text-blue-800">{{ check.details.email }}</a>
                                    </p>
                                    {% endif %}
                                    {% if check.details.website %}
                                    <p><span class="font-medium text-gray-700">Website:</span> 
                                       <a href="{{ check.details.website }}" target="_blank" class="text-blue-600 hover:text-blue-800">{{ check.details.website }}</a>
                                    </p>
                                    {% endif %}
                                </div>
                            </div>
                            {% endif %}
                            
                            <!-- Provider Description -->
                            {% if check.details.description %}
                            <div class="bg-indigo-50 rounded-lg p-3">
                                <h5 class="text-sm font-semibold text-gray-900 mb-2">Description</h5>
                                <p class="text-sm text-gray-700">{{ check.details.description }}</p>
                            </div>
                            {% endif %}
                            
                            <!-- Data Source Indicator -->
                            <div class="{% if 'Real Data' in check.data_source %}bg-green-50{% elif 'Simulated' in check.data_source %}bg-yellow-50{% else %}bg-gray-50{% endif %} rounded-lg p-3">
                                <h5 class="text-sm font-semibold text-gray-900 mb-1">Data Source</h5>
                                <div class="flex items-center text-sm">
                                    {% if 'Real Data' in check.data_source or 'Web Scraping' in check.data_source %}
                                    <svg class="w-4 h-4 text-green-600 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span class="text-green-700">{{ check.data_source }}</span>
                                    {% elif 'Simulated' in check.data_source %}
                                    <svg class="w-4 h-4 text-yellow-600 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span class="text-yellow-700">{{ check.data_source }}</span>
                                    {% else %}
                                    <svg class="w-4 h-4 text-gray-600 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span class="text-gray-700">{{ check.data_source }}</span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <!-- Error Display -->
                            {% if check.details.error %}
                            <div class="bg-red-50 border border-red-200 rounded-lg p-3">
                                <h5 class="text-sm font-semibold text-red-900 mb-2">Data Retrieval Issue</h5>
                                <p class="text-sm text-red-700">{{ check.details.error }}</p>
                            </div>
                            {% endif %}
                            
                            <!-- Mock Data Notice -->
                            {% if check.details.mock_data %}
                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                                <h5 class="text-sm font-semibold text-yellow-900 mb-2">Simulated Data Notice</h5>
                                <p class="text-sm text-yellow-700">{{ check.details.note or "This data is simulated for demonstration purposes" }}</p>
                            </div>
                            {% endif %}
                        </div>
                        {% endif %}
                        
                        {% if check.recommendations %}
                        <div class="mt-3 pt-3 border-t border-gray-200">
                            <p class="text-xs font-medium text-gray-500 mb-2">Recommendations:</p>
                            <ul class="text-xs text-gray-600 space-y-1">
                                {% for rec in check.recommendations %}
                                <li class="flex items-start">
                                    <svg class="h-3 w-3 text-blue-500 mt-0.5 mr-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                                    </svg>
                                    {{ rec }}
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                    <div class="ml-4 text-right">
                        <div class="text-lg font-bold text-gray-900">{{ "%.1f%%"|format((check.risk_score or 0) * 100) }}</div>
                        <div class="text-xs text-gray-500">Risk Score</div>
                        {% if 'Real Data' in check.data_source or 'Web Scraping' in check.data_source %}
                        <div class="text-xs text-green-600 mt-1">‚úì Real Data</div>
                        {% elif 'Simulated' in check.data_source %}
                        <div class="text-xs text-yellow-600 mt-1">‚ö† Simulated</div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Postcode Validation -->
            {% if provider.kyc_results.postcode_validation %}
            {% set check = provider.kyc_results.postcode_validation %}
            <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <div class="flex items-center mb-2">
                            <h4 class="text-base font-medium text-gray-900">Postcode Validation</h4>
                            <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                                {% if check.status == 'passed' %}bg-green-100 text-green-800{% elif check.status == 'flagged' %}bg-yellow-100 text-yellow-800{% elif check.status == 'failed' %}bg-red-100 text-red-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                                {{ check.status|title }}
                            </span>
                        </div>
                        <p class="text-sm text-gray-600 mb-2">{{ check.data_source }}</p>
                        
                        {% if check.details %}
                        <div class="text-sm space-y-1">
                            {% if check.details.postcode %}
                            <p><span class="font-medium">Postcode:</span> {{ check.details.postcode }}</p>
                            {% endif %}
                            {% if check.details.country %}
                            <p><span class="font-medium">Country:</span> {{ check.details.country }}</p>
                            {% endif %}
                            {% if check.details.region %}
                            <p><span class="font-medium">Region:</span> {{ check.details.region }}</p>
                            {% endif %}
                            {% if check.details.admin_district %}
                            <p><span class="font-medium">District:</span> {{ check.details.admin_district }}</p>
                            {% endif %}
                            {% if check.details.admin_county %}
                            <p><span class="font-medium">County:</span> {{ check.details.admin_county }}</p>
                            {% endif %}
                            {% if check.details.parliamentary_constituency %}
                            <p><span class="font-medium">Constituency:</span> {{ check.details.parliamentary_constituency }}</p>
                            {% endif %}
                            {% if check.details.coordinates %}
                            <p><span class="font-medium">Coordinates:</span> {{ "%.4f"|format(check.details.coordinates.latitude) }}, {{ "%.4f"|format(check.details.coordinates.longitude) }}</p>
                            <div class="mt-2">
                                <iframe
                                    width="100%"
                                    height="250"
                                    style="border:0"
                                    loading="lazy"
                                    referrerpolicy="no-referrer-when-downgrade"
                                    src="https://maps.google.com/maps?q=&layer=c&cbll={{ check.details.coordinates.latitude }},{{ check.details.coordinates.longitude }}&cbp=11,0,0,0,0&output=svembed">
                                </iframe>
                            </div>
                            {% endif %}
                            {% if check.details.error %}
                            <p><span class="font-medium text-red-600">Error:</span> {{ check.details.error }}</p>
                            {% endif %}
                        </div>
                        {% endif %}
                        
                        {% if check.recommendations %}
                        <div class="mt-2">
                            <p class="text-xs font-medium text-gray-500 mb-1">Recommendations:</p>
                            <ul class="text-xs text-gray-600 space-y-1">
                                {% for rec in check.recommendations %}
                                <li>‚Ä¢ {{ rec }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                    <div class="ml-4 text-right">
                        <div class="text-lg font-bold text-gray-900">{{ "%.1f%%"|format((check.risk_score or 0) * 100) }}</div>
                        <div class="text-xs text-gray-500">Risk Score</div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Ofqual Recognition 
            {% if provider.kyc_results.ofqual_recognition %}
            {% set check = provider.kyc_results.ofqual_recognition %}
            <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <div class="flex items-center mb-2">
                            <h4 class="text-base font-medium text-gray-900">Ofqual Recognition</h4>
                            <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                                {% if check.status == 'passed' %}bg-green-100 text-green-800{% elif check.status == 'flagged' %}bg-yellow-100 text-yellow-800{% elif check.status == 'failed' %}bg-red-100 text-red-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                                {{ check.status|title }}
                            </span>
                        </div>
                        <p class="text-sm text-gray-600 mb-2">{{ check.data_source }}</p>
                        
                        {% if check.details %}
                        <div class="text-sm space-y-1">
                            {% if check.details.recognised is defined %}
                            <p><span class="font-medium">Recognised Awarding Organisation:</span> {{ 'Yes' if check.details.recognised else 'No' }}</p>
                            {% endif %}
                            {% if check.details.note %}
                            <p><span class="font-medium">Note:</span> {{ check.details.note }}</p>
                            {% endif %}
                        </div>
                        {% endif %}
                        
                        {% if check.recommendations %}
                        <div class="mt-2">
                            <p class="text-xs font-medium text-gray-500 mb-1">Recommendations:</p>
                            <ul class="text-xs text-gray-600 space-y-1">
                                {% for rec in check.recommendations %}
                                <li>‚Ä¢ {{ rec }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                    <div class="ml-4 text-right">
                        <div class="text-lg font-bold text-gray-900">{{ "%.1f%%"|format((check.risk_score or 0) * 100) }}</div>
                        <div class="text-xs text-gray-500">Risk Score</div>
                    </div>
                </div>
            </div>
            {% endif %}-->

            <!-- Ofsted Rating -->
            {% if provider.kyc_results.ofsted_rating %}
            {% set check = provider.kyc_results.ofsted_rating %}
            <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <div class="flex items-center mb-2">
                            <h4 class="text-base font-medium text-gray-900">Ofsted Rating</h4>
                            <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                                {% if check.status == 'passed' %}bg-green-100 text-green-800{% elif check.status == 'flagged' %}bg-yellow-100 text-yellow-800{% elif check.status == 'failed' %}bg-red-100 text-red-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                                {{ check.status|title }}
                            </span>
                        </div>
                        <p class="text-sm text-gray-600 mb-3">{{ check.data_source }}</p>
                        
                        {% if check.details %}
                        <div class="space-y-3">
                            <!-- Main Inspection Information -->
                            <div class="bg-blue-50 rounded-lg p-3">
                                <h5 class="text-sm font-semibold text-gray-900 mb-2">Latest Inspection</h5>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                                    {% if check.details.latest_overall_effectiveness %}
                                    <div>
                                        <span class="font-medium text-gray-700">Overall Effectiveness:</span>
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ml-2
                                            {% if check.details.latest_overall_effectiveness == 'Outstanding' %}bg-green-100 text-green-800
                                            {% elif check.details.latest_overall_effectiveness == 'Good' %}bg-blue-100 text-blue-800
                                            {% elif check.details.latest_overall_effectiveness == 'Requires improvement' or check.details.latest_overall_effectiveness == 'Requires Improvement' %}bg-yellow-100 text-yellow-800
                                            {% elif check.details.latest_overall_effectiveness == 'Inadequate' %}bg-red-100 text-red-800
                                            {% else %}bg-gray-100 text-gray-800{% endif %}">
                                            {{ check.details.latest_overall_effectiveness }}
                                        </span>
                                    </div>
                                    {% endif %}
                                    
                                    {% if check.details.safeguarding_effectiveness %}
                                    <div>
                                        <span class="font-medium text-gray-700">Safeguarding:</span>
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ml-2
                                            {% if check.details.safeguarding_effectiveness == 'Outstanding' %}bg-green-100 text-green-800
                                            {% elif check.details.safeguarding_effectiveness == 'Good' %}bg-blue-100 text-blue-800
                                            {% elif check.details.safeguarding_effectiveness == 'Requires improvement' or check.details.safeguarding_effectiveness == 'Requires Improvement' %}bg-yellow-100 text-yellow-800
                                            {% elif check.details.safeguarding_effectiveness == 'Inadequate' %}bg-red-100 text-red-800
                                            {% else %}bg-gray-100 text-gray-800{% endif %}">
                                            {{ check.details.safeguarding_effectiveness }}
                                        </span>
                                    </div>
                                    {% endif %}
                                    
                                    {% if check.details.latest_inspection_date %}
                                    <div>
                                        <span class="font-medium text-gray-700">Inspection Date:</span>
                                        <p class="text-gray-900">{{ check.details.latest_inspection_date }}</p>
                                    </div>
                                    {% endif %}
                                    
                                    {% if check.details.urn %}
                                    <div>
                                        <span class="font-medium text-gray-700">URN:</span>
                                        <p class="text-gray-900 font-mono">{{ check.details.urn }}</p>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <!-- Provider Information -->
                            {% if check.details.title %}
                            <div class="bg-gray-50 rounded-lg p-3">
                                <h5 class="text-sm font-semibold text-gray-900 mb-2">Provider Information</h5>
                                <div class="text-sm space-y-1">
                                    <p><span class="font-medium text-gray-700">Full Name:</span> {{ check.details.title }}</p>
                                    {% if check.details.address %}
                                    <p><span class="font-medium text-gray-700">Address:</span> {{ check.details.address }}</p>
                                    {% endif %}
                                </div>
                            </div>
                            {% endif %}
                            
                            <!-- Inspection Timeline -->
                            {% if check.details.timeline and check.details.timeline|length > 0 %}
                            <div class="bg-purple-50 rounded-lg p-3">
                                <h5 class="text-sm font-semibold text-gray-900 mb-2">Recent Inspection Activity</h5>
                                <div class="space-y-2 max-h-32 overflow-y-auto">
                                    {% for event in check.details.timeline[:5] %}
                                    {% if event.timeline_date and event.event_title %}
                                    <div class="text-xs border-l-2 border-purple-200 pl-2">
                                        <p class="font-medium text-purple-900">{{ event.timeline_date }}</p>
                                        <p class="text-purple-700">{{ event.event_title }}</p>
                                    </div>
                                    {% endif %}
                                    {% endfor %}
                                    {% if check.details.timeline|length > 5 %}
                                    <p class="text-xs text-purple-600 italic">... and {{ check.details.timeline|length - 5 }} more events</p>
                                    {% endif %}
                                </div>
                            </div>
                            {% endif %}
                            
                            <!-- Report Download -->
                            {% if check.details.report_url and check.details.report_url != "Not available" %}
                            <div class="bg-indigo-50 rounded-lg p-3">
                                <h5 class="text-sm font-semibold text-gray-900 mb-2">Official Report</h5>
                                <a href="{{ check.details.report_url }}" 
                                   target="_blank"
                                   class="inline-flex items-center text-sm text-indigo-600 hover:text-indigo-800">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                    Download Full Ofsted Report
                                    <svg class="w-3 h-3 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                    </svg>
                                </a>
                            </div>
                            {% endif %}
                            
                            <!-- Data Source Indicator -->
                            <div class="{% if 'Real Data' in check.data_source %}bg-green-50{% elif 'Simulated' in check.data_source %}bg-yellow-50{% else %}bg-gray-50{% endif %} rounded-lg p-3">
                                <h5 class="text-sm font-semibold text-gray-900 mb-1">Data Source</h5>
                                <div class="flex items-center text-sm">
                                    {% if 'Real Data' in check.data_source or 'Web Scraping' in check.data_source %}
                                    <svg class="w-4 h-4 text-green-600 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span class="text-green-700">{{ check.data_source }}</span>
                                    {% elif 'Simulated' in check.data_source %}
                                    <svg class="w-4 h-4 text-yellow-600 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span class="text-yellow-700">{{ check.data_source }}</span>
                                    {% else %}
                                    <svg class="w-4 h-4 text-gray-600 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span class="text-gray-700">{{ check.data_source }}</span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <!-- Error Display -->
                            {% if check.details.error %}
                            <div class="bg-red-50 border border-red-200 rounded-lg p-3">
                                <h5 class="text-sm font-semibold text-red-900 mb-2">Data Retrieval Issue</h5>
                                <p class="text-sm text-red-700">{{ check.details.error }}</p>
                            </div>
                            {% endif %}
                        </div>
                        {% endif %}
                        
                        {% if check.recommendations %}
                        <div class="mt-3 pt-3 border-t border-gray-200">
                            <p class="text-xs font-medium text-gray-500 mb-2">Recommendations:</p>
                            <ul class="text-xs text-gray-600 space-y-1">
                                {% for rec in check.recommendations %}
                                <li class="flex items-start">
                                    <svg class="h-3 w-3 text-blue-500 mt-0.5 mr-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                                    </svg>
                                    {{ rec }}
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                    <div class="ml-4 text-right">
                        <div class="text-lg font-bold text-gray-900">{{ "%.1f%%"|format((check.risk_score or 0) * 100) }}</div>
                        <div class="text-xs text-gray-500">Risk Score</div>
                        {% if 'Real Data' in check.data_source or 'Web Scraping' in check.data_source %}
                        <div class="text-xs text-green-600 mt-1">‚úì Real Data</div>
                        {% elif 'Simulated' in check.data_source %}
                        <div class="text-xs text-yellow-600 mt-1">‚ö† Simulated</div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- ESFA Funding Status 
            {% if provider.kyc_results.esfa_funding_status %}
            {% set check = provider.kyc_results.esfa_funding_status %}
            <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <div class="flex items-center mb-2">
                            <h4 class="text-base font-medium text-gray-900">ESFA Funding Status</h4>
                            <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                                {% if check.status == 'passed' %}bg-green-100 text-green-800{% elif check.status == 'flagged' %}bg-yellow-100 text-yellow-800{% elif check.status == 'failed' %}bg-red-100 text-red-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                                {{ check.status|title }}
                            </span>
                        </div>
                        <p class="text-sm text-gray-600 mb-2">{{ check.data_source }}</p>
                        
                        {% if check.details %}
                        <div class="text-sm space-y-1">
                            {% if check.details.provider_status %}
                            <p><span class="font-medium">RoATP Status:</span> {{ check.details.provider_status }}</p>
                            {% endif %}
                            {% if check.details.funding_restrictions %}
                            <p><span class="font-medium">Funding Restrictions:</span> {{ check.details.funding_restrictions|length if check.details.funding_restrictions else 'None' }}</p>
                            {% endif %}
                        </div>
                        {% endif %}
                        
                        {% if check.recommendations %}
                        <div class="mt-2">
                            <p class="text-xs font-medium text-gray-500 mb-1">Recommendations:</p>
                            <ul class="text-xs text-gray-600 space-y-1">
                                {% for rec in check.recommendations %}
                                <li>‚Ä¢ {{ rec }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                    <div class="ml-4 text-right">
                        <div class="text-lg font-bold text-gray-900">{{ "%.1f%%"|format((check.risk_score or 0) * 100) }}</div>
                        <div class="text-xs text-gray-500">Risk Score</div>
                    </div>
                </div>
            </div>
            {% endif %}-->

            <!-- Sanctions Screening 
            {% if provider.kyc_results.sanctions_screening %}
            {% set check = provider.kyc_results.sanctions_screening %}
            <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <div class="flex items-center mb-2">
                            <h4 class="text-base font-medium text-gray-900">Sanctions Screening</h4>
                            <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                                {% if check.status == 'passed' %}bg-green-100 text-green-800{% elif check.status == 'flagged' %}bg-yellow-100 text-yellow-800{% elif check.status == 'failed' %}bg-red-100 text-red-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                                {{ check.status|title }}
                            </span>
                        </div>
                        <p class="text-sm text-gray-600 mb-2">{{ check.data_source }}</p>
                        
                        {% if check.details %}
                        <div class="text-sm space-y-1">
                            {% if check.details.matches is defined %}
                            <p><span class="font-medium">Sanctions Matches:</span> {{ 'Yes' if check.details.matches else 'No' }}</p>
                            {% endif %}
                            {% if check.details.checked_lists %}
                            <p><span class="font-medium">Lists Checked:</span> {{ check.details.checked_lists|join(', ') }}</p>
                            {% endif %}
                        </div>
                        {% endif %}
                        
                        {% if check.recommendations %}
                        <div class="mt-2">
                            <p class="text-xs font-medium text-gray-500 mb-1">Recommendations:</p>
                            <ul class="text-xs text-gray-600 space-y-1">
                                {% for rec in check.recommendations %}
                                <li>‚Ä¢ {{ rec }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                    <div class="ml-4 text-right">
                        <div class="text-lg font-bold text-gray-900">{{ "%.1f%%"|format((check.risk_score or 0) * 100) }}</div>
                        <div class="text-xs text-gray-500">Risk Score</div>
                    </div>
                </div>
            </div>
            {% endif %}-->

            <!-- Educational Risk Assessment -->
            {% if provider.kyc_results.educational_risk_assessment %}
            {% set check = provider.kyc_results.educational_risk_assessment %}
            <div class="border-2 border-blue-200 rounded-lg p-4 bg-blue-50">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <div class="flex items-center mb-2">
                            <h4 class="text-base font-medium text-blue-900">Educational Risk Assessment</h4>
                            <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                {{ check.status|title }}
                            </span>
                        </div>
                        <p class="text-sm text-blue-600 mb-2">{{ check.data_source }}</p>
                        
                        {% if check.details %}
                        <div class="text-sm space-y-1">
                            {% if check.details.risk_level %}
                            <p><span class="font-medium">Risk Level:</span> {{ check.details.risk_level|title }}</p>
                            {% endif %}
                            {% if check.details.total_checks %}
                            <p><span class="font-medium">Total Checks:</span> {{ check.details.total_checks }}</p>
                            {% endif %}
                            {% if check.details.risk_factors %}
                            <p><span class="font-medium">Risk Factors:</span> {{ check.details.risk_factors|join(', ') if check.details.risk_factors else 'None identified' }}</p>
                            {% endif %}
                            {% if check.details.critical_issues %}
                            <p><span class="font-medium">Critical Issues:</span> {{ check.details.critical_issues|join(', ') if check.details.critical_issues else 'None identified' }}</p>
                            {% endif %}
                        </div>
                        {% endif %}
                        
                        {% if check.recommendations %}
                        <div class="mt-2">
                            <p class="text-xs font-medium text-blue-600 mb-1">Recommendations:</p>
                            <ul class="text-xs text-blue-700 space-y-1">
                                {% for rec in check.recommendations %}
                                <li>‚Ä¢ {{ rec }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                    <div class="ml-4 text-right">
                        <div class="text-lg font-bold text-blue-900">{{ "%.1f%%"|format((check.risk_score or 0) * 100) }}</div>
                        <div class="text-xs text-blue-600">Risk Score</div>
                    </div>
                </div>
            </div>
            {% endif %}

        </div>
    </div>
    {% endif %}

    <!-- Technical Details -->
    {% if provider.verification_summary %}
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Technical Details</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm">
            {% if provider.verification_summary.total_checks %}
            <div>
                <label class="text-xs font-medium text-gray-500">Total Checks</label>
                <p class="text-gray-900 font-semibold">{{ provider.verification_summary.total_checks }}</p>
            </div>
            {% endif %}
            {% if provider.verification_summary.orchestrator_used is defined %}
            <div>
                <label class="text-xs font-medium text-gray-500">Orchestrator Used</label>
                <p class="text-gray-900 font-semibold">{{ 'Yes' if provider.verification_summary.orchestrator_used else 'No' }}</p>
            </div>
            {% endif %}
            {% if provider.verification_summary.risk_factors_count is defined %}
            <div>
                <label class="text-xs font-medium text-gray-500">Risk Factors</label>
                <p class="text-gray-900 font-semibold">{{ provider.verification_summary.risk_factors_count }}</p>
            </div>
            {% endif %}
            {% if provider.verification_summary.recommendations_count is defined %}
            <div>
                <label class="text-xs font-medium text-gray-500">Recommendations</label>
                <p class="text-gray-900 font-semibold">{{ provider.verification_summary.recommendations_count }}</p>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Action Buttons -->
    <div class="flex justify-between items-center">
        <a href="/" class="text-gray-600 hover:text-gray-800 flex items-center">
            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
            Back to Dashboard
        </a>
        <div class="space-x-4">
            <button onclick="window.print()" class="bg-gray-600 text-white px-6 py-2 rounded-md hover:bg-gray-700">
                Print Results
            </button>
            <a href="/onboard" class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700">
                Add Another Provider
            </a>
        </div>
    </div>
</div>

<style>
@media print {
    .no-print {
        display: none !important;
    }
    body {
        -webkit-print-color-adjust: exact;
        color-adjust: exact;
    }
}
</style>
{% endblock %}
